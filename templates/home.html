<!doctype html>
<html lang="en">
    <head>
        <title>Librarian for Spotify</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style_home.css') }}" />
        <!-- <script src="{{ url_for('static',filename='js/getsongs.js')}}"></script> -->
    </head>
    <body>
        <div id="content">
            <header>Librarian for Spotify</header>
            <div id="songs">
                <h1></h1>
                
            </div>
            <div id="playlist-options">
                
            </div>
        </div>

        <script>
            document.getElementById('content').className = 'loading';
            let auth = 'Bearer ' + '{{token}}' ;
            let header = {Authorization: auth};
            let user_tracks = [];
            fetch('https://api.spotify.com/v1/me/tracks?limit=50',{headers:header}).then(res => res.json()).then(response => {

            function compileSongData(track)
            {
                let id = track['track']['id'];
                let popularity = track['track']['popularity'];
                let duration = track['track']['duration_ms'];
                let explicit = track['track']['explicit'];


                let track_data = {
                    id:id,
                    popularity:popularity,
                    duration:duration,
                    explicit:explicit
                };
                return track_data;
            }
            
                while (response['next'] != null) {
                    // for (let track of response['items']) {
                    //     let id = track['track']['id']
                    //     let popularity = track['track']['popularity']
                    //     let duration = track['track']['duration_ms']
                    //     let explicit = track['track']['explicit']                        


                    //     let track_dict = {
                    //         id:id,
                    //         popularity:popularity,
                    //         duration:duration,
                    //         explicit:explicit,
                            
                    //     };
                    //     user_tracks.push(track_dict)
                    // }

                    let tracks_batch = response['items'].map(compileSongData)
                    user_tracks = user_tracks.concat(tracks_batch)

                    fetch(response['next'],{headers:header}).then(res => response = res.json()).then()
                }
                return user_tracks;
            }).then(user_tracks => {
                console.log(user_tracks)
            });
        </script>
    </body>
</html>
